<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Training Plan</title>
<meta name="theme-color" content="#0f172a" />
<style>
  :root { --bg:#0b1020; --card:#11162a; --ink:#e5e7eb; --muted:#aab1c2; --accent:#6ee7b7; --ring:#334155; --ink-dark:#0a0f1e; }
  * { box-sizing: border-box; }
  html, body { margin:0; padding:0; background:linear-gradient(180deg,#0b1020, #0e1326 30%, #0b1020); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans"; }
  a { color: inherit; text-decoration: none; }
  .wrap { max-width: 980px; margin: 0 auto; padding: 20px; }
  header { display:flex; gap:12px; align-items:center; justify-content:space-between; padding:8px 0 16px; position: sticky; top:0; backdrop-filter: blur(6px); background: rgba(11,16,32,0.7); z-index:10; }
  .title { font-weight:700; letter-spacing:.2px; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .title h1 { margin:0; }
  .title small { opacity:.75; font-weight:500; }
  .toolbar { display:flex; gap:12px; align-items:center; }
  .clock { padding:8px 12px; border:1px solid var(--ring); border-radius:12px; font-variant-numeric: tabular-nums; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); }
  .btn { border:1px solid var(--ring); background:transparent; color:var(--ink); padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
  .btn:hover { border-color:#44506a; }
  .groups { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:8px; overflow:auto hidden; padding:8px 0 2px; scrollbar-width:none; }
  .chip { padding:10px 12px; border:1px solid var(--ring); border-radius:999px; text-align:center; white-space:nowrap; cursor:pointer; user-select:none; }
  .chip.active { background:var(--ink); color:var(--ink-dark); border-color:transparent; }
  .grid { display:grid; grid-template-columns: repeat( auto-fill, minmax(260px, 1fr) ); gap:14px; margin-top:16px; }
  .card { border:1px solid var(--ring); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); border-radius:16px; padding:14px; display:flex; flex-direction:column; gap:10px; min-height:140px; transition: transform .08s ease, border-color .15s ease; }
  .card:hover { transform: translateY(-2px); border-color:#44506a; }
  .media { position:relative; border-radius:12px; overflow:hidden; background:#0f152b; aspect-ratio:16/9; display:flex; align-items:center; justify-content:center; border:1px solid #1f2942; }
  .badge { font-size:12px; color:var(--ink-dark); background:var(--accent); border-radius:999px; padding:4px 8px; font-weight:700; width:fit-content; }
  .name { font-weight:700; font-size:18px; letter-spacing:.2px; }
  .meta { display:flex; gap:8px; flex-wrap:wrap; align-items:center; color:#cbd5e1; }
  .empty { opacity:.7; padding:24px; border:1px dashed var(--ring); border-radius:14px; text-align:center; }
  .foot { opacity:.6; font-size:12px; margin:18px 0 6px; text-align:center; }
  .nav { margin-top:12px; display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
  .link { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border:1px solid var(--ring); border-radius:12px; }
  .dim { color:var(--muted); }
  .detail { display:grid; gap:14px; margin-top:16px; }
  .detail h2 { margin:0; font-size:22px; }
  .two-col { display:grid; gap:14px; grid-template-columns: 1fr; }
  @media (min-width: 850px){ .two-col { grid-template-columns: 1fr 1fr; } }
  .notes { border:1px solid var(--ring); border-radius:14px; padding:12px; color:#d1d5db; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); }
  .legend { display:flex; flex-wrap:wrap; gap:8px; }
  .tag { border:1px solid var(--ring); border-radius:999px; padding:4px 10px; font-size:12px; color:#cbd5e1; }
  .toggle { display:flex; gap:8px; background:rgba(255,255,255,0.03); border:1px solid var(--ring); border-radius:12px; padding:4px; width:max-content; }
  .toggle button { border:none; background:transparent; color:var(--ink); padding:6px 10px; border-radius:8px; cursor:pointer; }
  .toggle button.active { background:var(--ink); color:var(--ink-dark); }
  .qrbox { display:none; align-items:center; gap:10px; margin-left:8px; }
  .qrbox input { width:260px; background:transparent; border:1px solid var(--ring); border-radius:10px; padding:10px; color:var(--ink); outline:none; }
  .qrbox img { width:64px; height:64px; border-radius:8px; border:1px solid var(--ring); background:#0f152b; }
  model-viewer { width:100%; height:100%; background:transparent; }
</style>
<!-- Optional 3D viewer. Safe to leave in even if unused. -->
<script type="module" src="https://unpkg.com/@google/model-viewer@3.3.0/dist/model-viewer.min.js"></script>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">
      <h1>Training Plan</h1>
      <small id="planLabel"></small>
    </div>
    <div class="toolbar">
      <div class="clock" id="clock">--/--/---- --:--:--</div>
      <button class="btn" id="shareBtn" title="Copy link to this plan">Share</button>
      <div class="qrbox" id="qrBox">
        <input id="urlInput" placeholder="Paste live URL to make QR" />
        <img id="qrImg" alt="QR code"/>
      </div>
    </div>
  </header>

  <div id="routerView"></div>
  <div class="foot">Add to home screen for 1-tap access. No app store, no updates, no excuses.</div>
</div>

<script>
  // ---------- EDIT ONLY THIS DATA BLOCK ----------
  const PLAN = {
    label: "Grouped by Muscle",
    groups: {
      Back: [
        { name: "Lat Pulldown", slug: "lat-pulldown", order: 1, sets: "4 × 10–12",
          youtube: "https://www.youtube.com/watch?v=CAwf7n6Luuc",
          photo: "https://via.placeholder.com/1280x720?text=Lat+Pulldown+Machine",
          muscles: { primary: ["Latissimus dorsi"], secondary: ["Teres major","Biceps brachii","Mid traps"] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Lats+(Front/Back)",
          model3d: "" /* optional: put a GLB URL here to enable the 3D toggle, e.g. "https://example.com/human_muscles.glb" */,
          notes: "Grip just wider than shoulders, elbows drive down, touch upper chest, slow eccentric, no torso swing." },
        { name: "Seated Cable Row", slug: "seated-cable-row", order: 2, sets: "4 × 10–12",
          youtube: "https://www.youtube.com/watch?v=GZbfZ033f74",
          photo: "https://via.placeholder.com/1280x720?text=Seated+Row+Machine",
          muscles: { primary: ["Mid–lower traps","Rhomboids"], secondary: ["Lats","Rear delts","Biceps"] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Mid-back",
          model3d: "",
          notes: "Neutral spine, pull to lower ribs, squeeze shoulder blades together, avoid shrugging." },
        { name: "Chest-Supported Row", slug: "chest-supported-row", order: 3, sets: "3 × 8–10",
          youtube: "https://www.youtube.com/watch?v=8n0Qk8b7wEw",
          photo: "https://via.placeholder.com/1280x720?text=Chest+Supported+Row",
          muscles: { primary: ["Lats","Mid traps"], secondary: ["Rear delts","Biceps"] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Lats+%2F+Scapular+retractors",
          model3d: "",
          notes: "Bench 30–45°, pull elbows along body, brief pause at top, keep ribs down." },
        { name: "Straight-Arm Pulldown", slug: "straight-arm-pulldown", order: 4, sets: "3 × 12–15",
          youtube: "https://www.youtube.com/watch?v=4vT4fzjkGCQ",
          photo: "https://via.placeholder.com/1280x720?text=Straight+Arm+Pulldown",
          muscles: { primary: ["Lats"], secondary: ["Teres major","Long head triceps"] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Lats+%2F+Teres",
          model3d: "",
          notes: "Arms mostly straight, pull in an arc to thighs, lats initiate, no rib flaring." }
      ],
      Chest: [
        { name: "Chest Press Machine", slug: "chest-press", order: 1, sets: "4 × 8–12",
          youtube: "https://www.youtube.com/watch?v=2tKXW4J9xCc",
          photo: "https://via.placeholder.com/1280x720?text=Chest+Press+Machine",
          muscles: { primary: ["Pectoralis major"], secondary: ["Anterior delts","Triceps"] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Chest",
          model3d: "",
          notes: "Shoulders packed, slow down phase, optional full lockout, feet planted." },
        { name: "Incline Dumbbell Press", slug: "incline-db-press", order: 2, sets: "3 × 8–10",
          youtube: "https://www.youtube.com/watch?v=8iPEnn-ltC8",
          photo: "https://via.placeholder.com/1280x720?text=Incline+Bench",
          muscles: { primary: ["Upper chest"], secondary: ["Anterior delts","Triceps"] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Upper+Chest",
          model3d: "",
          notes: "30° incline, wrists stacked, slight pause at chest, no bouncing." }
      ],
      Shoulders: [
        { name: "Seated Shoulder Press", slug: "seated-shoulder-press", order: 1, sets: "4 × 8–10",
          youtube: "https://www.youtube.com/watch?v=qEwKCR5JCog",
          photo: "https://via.placeholder.com/1280x720?text=Shoulder+Press+Machine",
          muscles: { primary: ["Anterior delts","Medial delts"], secondary: ["Triceps","Upper traps (stabilizers)"] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Delts",
          model3d: "",
          notes: "No lower back arch, control tempo, finish with biceps by ears." },
        { name: "Lateral Raise Machine", slug: "lateral-raise", order: 2, sets: "3 × 12–15",
          youtube: "https://www.youtube.com/watch?v=3VcKaXpzqRo",
          photo: "https://via.placeholder.com/1280x720?text=Lateral+Raise+Machine",
          muscles: { primary: ["Medial delts"], secondary: ["Supraspinatus (initiation)"] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Medial+Delts",
          model3d: "",
          notes: "Soft elbows, lift to shoulder height, lead with elbows, no shrugging." }
      ],
      Legs: [
        { name: "Leg Press", slug: "leg-press", order: 1, sets: "4 × 10–12",
          youtube: "https://www.youtube.com/watch?v=IZxyjW7MPJQ",
          photo: "https://via.placeholder.com/1280x720?text=Leg+Press+Machine",
          muscles: { primary: ["Quads","Glutes"], secondary: ["Adductors","Calves (stabilizers)"] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Quads+%2F+Glutes",
          model3d: "",
          notes: "Shoulder-width stance, deep but controlled ROM, don’t slam lockout." },
        { name: "Seated Leg Curl", slug: "seated-leg-curl", order: 2, sets: "3 × 12–15",
          youtube: "https://www.youtube.com/watch?v=1Tq3QdYUuHs",
          photo: "https://via.placeholder.com/1280x720?text=Leg+Curl+Machine",
          muscles: { primary: ["Hamstrings"], secondary: ["Calves (gastrocnemius)"] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Hamstrings",
          model3d: "",
          notes: "Pad above ankles, hips back, squeeze at bottom, slow return." },
        { name: "Calf Raise", slug: "calf-raise", order: 3, sets: "4 × 12–15",
          youtube: "https://www.youtube.com/watch?v=YMmgqO8Jo-k",
          photo: "https://via.placeholder.com/1280x720?text=Calf+Raise+Machine",
          muscles: { primary: ["Gastrocnemius","Soleus"], secondary: [] },
          muscleImage: "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Target+Muscles:+Calves",
          model3d: "",
          notes: "Full stretch, pause at top, keep knees soft." }
      ]
    }
  };
  // ---------- STOP EDITING HERE ----------

  const GROUP_ORDER = ["Back","Chest","Shoulders","Legs"];
  const routerView = document.getElementById("routerView");
  const planLabel = document.getElementById("planLabel");
  const shareBtn = document.getElementById("shareBtn");
  const qrBox = document.getElementById("qrBox");
  const urlInput = document.getElementById("urlInput");
  const qrImg = document.getElementById("qrImg");
  const clockEl = document.getElementById("clock");

  planLabel.textContent = PLAN.label || "";

  // EU clock dd/mm/yyyy HH:MM:SS
  function two(n){ return String(n).padStart(2,"0"); }
  function formatEU(d){ return `${two(d.getDate())}/${two(d.getMonth()+1)}/${d.getFullYear()} ${two(d.getHours())}:${two(d.getMinutes())}:${two(d.getSeconds())}`; }
  function tick(){ clockEl.textContent = formatEU(new Date()); }
  tick(); setInterval(tick, 1000);

  function isYouTube(u){ return /youtu\.be|youtube\.com/.test(u||""); }
  function toYouTubeEmbed(u){
    try{
      const url=new URL(u);
      if(url.hostname==="youtu.be"){ return "https://www.youtube.com/embed/"+url.pathname.slice(1); }
      const id = url.searchParams.get("v");
      if(id) return "https://www.youtube.com/embed/"+id;
      if(url.pathname.startsWith("/shorts/")) return "https://www.youtube.com/embed/"+url.pathname.split("/")[2];
    }catch(e){}
    return u;
  }
  function slugify(s){ return String(s||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""); }
  function navTo(hash){ location.hash = hash; }
  function byOrder(a,b){ return (a.order||999) - (b.order||999); }

  function renderGroupsBar(active){
    const bar = document.createElement("div");
    bar.className = "groups";
    GROUP_ORDER.forEach(g=>{
      const chip = document.createElement("div");
      chip.className = "chip"+(g===active?" active":"");
      chip.textContent = g;
      chip.onclick = ()=> navTo(`#/group/${encodeURIComponent(g)}`);
      bar.appendChild(chip);
    });
    return bar;
  }

  function renderGroupView(group){
    const list = (PLAN.groups[group]||[]).slice().sort(byOrder);
    routerView.innerHTML = "";
    routerView.appendChild(renderGroupsBar(group));

    const head = document.createElement("div");
    head.className = "nav";
    head.innerHTML = `<span class="dim">Showing</span> <strong>${group}</strong>`;
    routerView.appendChild(head);

    if (!list.length){
      const empty = document.createElement("div");
      empty.className = "empty";
      empty.textContent = "Empty. Either intentional recovery or accidental procrastination.";
      routerView.appendChild(empty);
      return;
    }

    const grid = document.createElement("div");
    grid.className = "grid";
    list.forEach(ex=>{
      const card = document.createElement("div");
      card.className = "card";
      card.style.cursor = "pointer";

      const row = document.createElement("div");
      row.style.display="flex"; row.style.alignItems="center"; row.style.justifyContent="space-between";
      const name = document.createElement("div");
      name.className = "name";
      name.textContent = `${ex.order ? ex.order+". " : ""}${ex.name}`;
      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = ex.sets || "";
      row.appendChild(name); row.appendChild(badge);
      card.appendChild(row);

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = "Tap to open details";
      card.appendChild(meta);

      card.onclick = ()=> navTo(`#/exercise/${encodeURIComponent(group)}/${encodeURIComponent(ex.slug||slugify(ex.name))}`);
      grid.appendChild(card);
    });
    routerView.appendChild(grid);
  }

  function pill(text){
    const span = document.createElement("span");
    span.className = "tag";
    span.textContent = text;
    return span;
  }

  function renderExerciseView(group, slug){
    const list = (PLAN.groups[group]||[]).slice().sort(byOrder);
    const ex = list.find(e => (e.slug||slugify(e.name)) === slug);
    routerView.innerHTML = "";
    routerView.appendChild(renderGroupsBar(group));

    const back = document.createElement("div");
    back.className = "nav";
    const backLink = document.createElement("a");
    backLink.className = "link";
    backLink.href = `#/group/${encodeURIComponent(group)}`;
    backLink.textContent = "← Back to " + group;
    back.appendChild(backLink);
    routerView.appendChild(back);

    if (!ex){
      const empty = document.createElement("div");
      empty.className = "empty";
      empty.textContent = "Exercise not found. Either it was renamed or abducted by bad form.";
      routerView.appendChild(empty);
      return;
    }

    const section = document.createElement("section");
    section.className = "detail";

    const heading = document.createElement("h2");
    heading.textContent = ex.name;
    section.appendChild(heading);

    const meta = document.createElement("div");
    meta.className = "meta";
    const badge = document.createElement("div");
    badge.className = "badge";
    badge.textContent = ex.sets || "";
    meta.appendChild(badge);
    section.appendChild(meta);

    const mediaWrap = document.createElement("div");
    mediaWrap.className = "two-col";

    // Video box
    const videoBox = document.createElement("div");
    videoBox.className = "card";
    const video = document.createElement("div");
    video.className = "media";
    const iframe = document.createElement("iframe");
    iframe.src = toYouTubeEmbed(ex.youtube||"");
    iframe.title = ex.name + " video";
    iframe.loading = "lazy";
    iframe.allow = "accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
    iframe.referrerPolicy = "strict-origin-when-cross-origin";
    video.appendChild(iframe);
    const vcap = document.createElement("div");
    vcap.className = "dim";
    vcap.style.marginTop = "8px";
    vcap.textContent = "How to do it";
    videoBox.appendChild(video);
    videoBox.appendChild(vcap);

    // Machine photo box
    const photoBox = document.createElement("div");
    photoBox.className = "card";
    const photo = document.createElement("div");
    photo.className = "media";
    const img = document.createElement("img");
    img.src = ex.photo || "";
    img.alt = ex.name + " machine";
    img.loading = "lazy";
    img.style.width = "100%";
    img.style.height = "100%";
    img.style.objectFit = "cover";
    photo.appendChild(img);
    const pcap = document.createElement("div");
    pcap.className = "dim";
    pcap.style.marginTop = "8px";
    pcap.textContent = "Machine to use";
    photoBox.appendChild(photo);
    photoBox.appendChild(pcap);

    mediaWrap.appendChild(videoBox);
    mediaWrap.appendChild(photoBox);
    section.appendChild(mediaWrap);

    // Target muscles: Photo <-> 3D toggle
    const musclesBox = document.createElement("div");
    musclesBox.className = "card";
    const topRow = document.createElement("div");
    topRow.style.display = "flex";
    topRow.style.alignItems = "center";
    topRow.style.justifyContent = "space-between";
    const musclesTitle = document.createElement("div");
    musclesTitle.className = "name";
    musclesTitle.textContent = "Target muscles";
    topRow.appendChild(musclesTitle);

    const toggle = document.createElement("div");
    toggle.className = "toggle";
    const btnImg = document.createElement("button"); btnImg.textContent = "Photo";
    const btn3D  = document.createElement("button"); btn3D.textContent = "3D";
    toggle.appendChild(btnImg); toggle.appendChild(btn3D);
    topRow.appendChild(toggle);
    musclesBox.appendChild(topRow);

    const muscleMedia = document.createElement("div");
    muscleMedia.className = "media";
    const imgMuscle = document.createElement("img");
    imgMuscle.src = ex.muscleImage || "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Muscle+Targets";
    imgMuscle.alt = "Muscle targets";
    imgMuscle.loading = "lazy";
    imgMuscle.style.width = "100%";
    imgMuscle.style.height = "100%";
    imgMuscle.style.objectFit = "cover";

    // 3D viewer placeholder
    const viewer = document.createElement("model-viewer");
    viewer.style.display = "none";
    viewer.setAttribute("camera-controls", "");
    viewer.setAttribute("exposure", "0.9");
    viewer.setAttribute("shadow-intensity", "0");
    viewer.setAttribute("interaction-prompt", "none");
    if (ex.model3d){ viewer.src = ex.model3d; } // if empty, we'll keep it hidden

    muscleMedia.appendChild(imgMuscle);
    muscleMedia.appendChild(viewer);
    musclesBox.appendChild(muscleMedia);

    const legend = document.createElement("div");
    legend.className = "legend";
    const primaries = (ex.muscles?.primary||[]);
    const secondaries = (ex.muscles?.secondary||[]);
    if (primaries.length){ legend.appendChild(pill("Primary: " + primaries.join(", "))); }
    if (secondaries.length){ legend.appendChild(pill("Secondary: " + secondaries.join(", "))); }
    musclesBox.appendChild(legend);

    // Toggle logic
    function setToggle(which){
      btnImg.classList.toggle("active", which==="img");
      btn3D.classList.toggle("active", which==="3d");
      imgMuscle.style.display = which==="img" ? "block" : "none";
      viewer.style.display = which==="3d" ? "block" : "none";
    }
    btnImg.onclick = ()=> setToggle("img");
    btn3D.onclick  = ()=> {
      if (!ex.model3d){
        alert("Add a GLB model URL in the plan (model3d) to enable 3D.");
        return;
      }
      setToggle("3d");
    };
    setToggle("img");

    section.appendChild(musclesBox);

    // Notes
    const notes = document.createElement("div");
    notes.className = "notes";
    notes.textContent = ex.notes || "No notes. Breathe, move well, don’t be reckless.";
    section.appendChild(notes);

    routerView.appendChild(section);
  }

  function router(){
    const hash = location.hash || "";
    const parts = hash.split("/").map(x=>decodeURIComponent(x.replace(/^#*/, "")));
    if (parts[1] === "exercise" && parts.length >= 4){
      const group = parts[2];
      const slug = parts[3];
      renderExerciseView(group, slug);
    } else {
      const group = (parts[1] === "group" && parts[2]) ? parts[2] : GROUP_ORDER[0];
      renderGroupView(group);
    }
  }
  window.addEventListener("hashchange", router);
  router();

  // Share + QR helper
  shareBtn.addEventListener("click", async ()=> {
    const url = location.href;
    try{
      await navigator.clipboard.writeText(url);
      shareBtn.textContent = "Link copied";
      setTimeout(()=>shareBtn.textContent="Share",1400);
    }catch(e){
      if (navigator.share) {
        try { await navigator.share({ title: document.title, url }); } catch(_) {}
      } else {
        alert(url);
      }
    }
    qrBox.style.display = "flex";
    urlInput.value = url;
    updateQR();
  });

  function updateQR(){
    const u = encodeURIComponent((urlInput.value||"").trim());
    if (!u){ qrImg.src=""; return; }
    qrImg.src = `https://chart.googleapis.com/chart?cht=qr&chs=256x256&chld=M|0&chl=${u}`;
  }
  urlInput.addEventListener("input", updateQR);
</script>
</body>
</html>
