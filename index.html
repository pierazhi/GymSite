<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Training Plan</title>
<meta name="theme-color" content="#0f172a" />
<style>
  :root { --bg:#0b1020; --card:#11162a; --ink:#e5e7eb; --muted:#aab1c2; --accent:#6ee7b7; --ring:#334155; --ink-dark:#0a0f1e; --red:#ef4444; }
  * { box-sizing: border-box; }
  html, body { margin:0; padding:0; background:linear-gradient(180deg,#0b1020, #0e1326 30%, #0b1020); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans"; }
  a { color: inherit; text-decoration: none; }
  .wrap { max-width: 980px; margin: 0 auto; padding: 20px; }
  header { display:flex; gap:12px; align-items:center; justify-content:space-between; padding:8px 0 16px; position: sticky; top:0; backdrop-filter: blur(6px); background: rgba(11,16,32,0.7); z-index:10; }
  .title { font-weight:700; letter-spacing:.2px; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .title h1 { margin:0; }
  .title small { opacity:.75; font-weight:500; }
  .toolbar { display:flex; gap:12px; align-items:center; }
  .clock { padding:8px 12px; border:1px solid var(--ring); border-radius:12px; font-variant-numeric: tabular-nums; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); }
  .btn { border:1px solid var(--ring); background:transparent; color:var(--ink); padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
  .btn:hover { border-color:#44506a; }
  .groups { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:8px; overflow:auto hidden; padding:8px 0 2px; scrollbar-width:none; }
  .chip { padding:10px 12px; border:1px solid var(--ring); border-radius:999px; text-align:center; white-space:nowrap; cursor:pointer; user-select:none; }
  .chip.active { background:var(--ink); color:var(--ink-dark); border-color:transparent; }
  .grid { display:grid; grid-template-columns: repeat( auto-fill, minmax(260px, 1fr) ); gap:14px; margin-top:16px; }
  .card { border:1px solid var(--ring); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); border-radius:16px; padding:14px; display:flex; flex-direction:column; gap:10px; min-height:140px; transition: transform .08s ease, border-color .15s ease; }
  .card:hover { transform: translateY(-2px); border-color:#44506a; }
  .media { position:relative; border-radius:12px; overflow:hidden; background:#0f152b; aspect-ratio:16/9; display:flex; align-items:center; justify-content:center; border:1px solid #1f2942; }
  .badge { font-size:12px; color:var(--ink-dark); background:var(--accent); border-radius:999px; padding:4px 8px; font-weight:700; width:fit-content; }
  .name { font-weight:700; font-size:18px; letter-spacing:.2px; }
  .meta { display:flex; gap:8px; flex-wrap:wrap; align-items:center; color:#cbd5e1; }
  .muscleRow{ display:flex; gap:6px; flex-wrap:wrap; }
  .tagP{ background:rgba(255,255,255,0.06); border:1px solid var(--ring); color:#fde68a; border-radius:999px; padding:3px 8px; font-size:11px; font-weight:700; }
  .tagS{ background:rgba(255,255,255,0.03); border:1px dashed var(--ring); color:#a5b4fc; border-radius:999px; padding:3px 8px; font-size:11px; }
  .empty { opacity:.7; padding:24px; border:1px dashed var(--ring); border-radius:14px; text-align:center; }
  .foot { opacity:.6; font-size:12px; margin:18px 0 6px; text-align:center; }
  .nav { margin-top:12px; display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
  .link { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border:1px solid var(--ring); border-radius:12px; }
  .dim { color:var(--muted); }
  .detail { display:grid; gap:14px; margin-top:16px; }
  .detail h2 { margin:0; font-size:22px; }
  .two-col { display:grid; gap:14px; grid-template-columns: 1fr; }
  @media (min-width: 850px){ .two-col { grid-template-columns: 1fr 1fr; } }
  .notes { border:1px solid var(--ring); border-radius:14px; padding:12px; color:#d1d5db; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); }
  .legend { display:flex; flex-wrap:wrap; gap:8px; }
  .tag { border:1px solid var(--ring); border-radius:999px; padding:4px 10px; font-size:12px; color:#cbd5e1; }
  .toggleRow { display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-top:6px; }
  .muscleChips { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
  .mchip { border:1px solid var(--ring); border-radius:999px; padding:6px 10px; font-size:12px; cursor:pointer; user-select:none; }
  .mchip.active { background:var(--ink); color:var(--ink-dark); border-color:transparent; }
  .qrbox { display:none; align-items:center; gap:10px; margin-left:8px; }
  .qrbox input { width:260px; background:transparent; border:1px solid var(--ring); border-radius:10px; padding:10px; color:var(--ink); outline:none; }
  .qrbox img { width:64px; height:64px; border-radius:8px; border:1px solid var(--ring); background:#0f152b; }
  .maskOverlay{
    position:absolute; inset:0;
    background:var(--red);
    opacity:.85;
    pointer-events:none;
    mask-image: var(--mask-url);
    mask-repeat:no-repeat;
    mask-position:center;
    mask-size:contain;
    -webkit-mask-image: var(--mask-url);
    -webkit-mask-repeat:no-repeat;
    -webkit-mask-position:center;
    -webkit-mask-size:contain;
  }
  .attachGrid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); gap:10px; margin-top:8px; }
  .attachItem{ border:1px solid var(--ring); border-radius:12px; padding:10px; display:flex; gap:10px; align-items:center; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); }
  .attachThumb{ width:56px; height:56px; border-radius:10px; border:1px solid #1f2942; overflow:hidden; background:#0f152b; flex:0 0 56px; }
  .attachThumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .uploadRow{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  input[type="file"]{ display:none; }
  .fileLabel{ border:1px solid var(--ring); border-radius:10px; padding:6px 10px; cursor:pointer; font-size:12px; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">
      <h1>Training Plan</h1>
      <small id="planLabel"></small>
    </div>
    <div class="toolbar">
      <div class="clock" id="clock">--/--/---- --:--:--</div>
      <button class="btn" id="shareBtn" title="Copy link to this plan">Share</button>
      <div class="qrbox" id="qrBox">
        <input id="urlInput" placeholder="Paste live URL to make QR" />
        <img id="qrImg" alt="QR code"/>
      </div>
    </div>
  </header>

  <div id="routerView"></div>
  <div class="foot">Upload images into your repo and reference them with relative paths. The browser can’t eat GitHub web pages.</div>
</div>

<script>
  // ---------- EDIT ONLY THIS DATA BLOCK ----------
  // Put your images into an 'Image/' folder in this repo. Reference them like "Image/FlyMachine.jpeg".
  // If you insist on linking, use 'https://raw.githubusercontent.com/USER/REPO/BRANCH/Image/file.png' or add '?raw=1' to the blob URL.
  const PLAN = {
    label: "Grouped by Muscle",
    groups: {
      Back: [
        {
          name: "Lat Pulldown",
          slug: "lat-pulldown",
          order: 1,
          sets: "3 × 8",
          youtube: "https://www.youtube.com/shorts/suWROTA8PVY",
          photo: "Image/FlyMachine.jpeg",                                // ✅ relative path served by GitHub Pages
          muscles: {
            primary: ["Latissimus dorsi"],
            secondary: ["Teres major","Biceps brachii","Mid traps"],
            masks: [
              { name: "Lats",  url: "https://via.placeholder.com/1280x720.png?text=MASK+LATS",  active: false },
              { name: "Teres", url: "https://via.placeholder.com/1280x720.png?text=MASK+TERES", active: false }
            ]
          },
          muscleImage: "Image/eJzbY2gABqYGmAAohkXWFILjgRgAh9gMTA==.png",   // ✅ relative path; rename to something sane later
          attachments: [
            { name: "Wide lat bar", photo: "Image/OutsideHandle.jpg" }   // ✅ relative path
          ],
          notes: "Grip just wider than shoulders, elbows drive down, touch upper chest, slow eccentric, no torso swing."
        }
      ],
      Chest: [],
      Shoulders: [],
      Legs: []
    }
  };
  // ---------- STOP EDITING HERE ----------

  const GROUP_ORDER = ["Back","Chest","Shoulders","Legs"];
  const routerView = document.getElementById("routerView");
  const planLabel = document.getElementById("planLabel");
  const shareBtn = document.getElementById("shareBtn");
  const qrBox = document.getElementById("qrBox");
  const urlInput = document.getElementById("urlInput");
  const qrImg = document.getElementById("qrImg");
  const clockEl = document.getElementById("clock");

  planLabel.textContent = PLAN.label || "";

  // EU clock dd/mm/yyyy HH:MM:SS
  function two(n){ return String(n).padStart(2,"0"); }
  function formatEU(d){ return `${two(d.getDate())}/${two(d.getMonth()+1)}/${d.getFullYear()} ${two(d.getHours())}:${two(d.getMinutes())}:${two(d.getSeconds())}`; }
  function tick(){ clockEl.textContent = formatEU(new Date()); }
  tick(); setInterval(tick, 1000);

  function slugify(s){ return String(s||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""); }
  function navTo(hash){ location.hash = hash; }
  function byOrder(a,b){ return (a.order||999) - (b.order||999); }

  function toYouTubeEmbed(u){
    try{
      const url=new URL(u);
      if(url.hostname==="youtu.be"){ return "https://www.youtube.com/embed/"+url.pathname.slice(1); }
      const id = url.searchParams.get("v");
      if(id) return "https://www.youtube.com/embed/"+id;
      if(url.pathname.startsWith("/shorts/")) return "https://www.youtube.com/embed/"+url.pathname.split("/")[2];
    }catch(e){}
    return u;
  }

  function renderGroupsBar(active){
    const bar = document.createElement("div");
    bar.className = "groups";
    GROUP_ORDER.forEach(g=>{
      const chip = document.createElement("div");
      chip.className = "chip"+(g===active?" active":"");
      chip.textContent = g;
      chip.onclick = ()=> navTo(`#/group/${encodeURIComponent(g)}`);
      bar.appendChild(chip);
    });
    return bar;
  }

  function renderGroupView(group){
    const list = (PLAN.groups[group]||[]).slice().sort(byOrder);
    routerView.innerHTML = "";
    routerView.appendChild(renderGroupsBar(group));

    const head = document.createElement("div");
    head.className = "nav";
    head.innerHTML = `<span class="dim">Showing</span> <strong>${group}</strong>`;
    routerView.appendChild(head);

    if (!list.length){
      const empty = document.createElement("div");
      empty.className = "empty";
      empty.textContent = "Empty. Either intentional recovery or accidental procrastination.";
      routerView.appendChild(empty);
      return;
    }

    const grid = document.createElement("div");
    grid.className = "grid";
    list.forEach(ex=>{
      const card = document.createElement("div");
      card.className = "card";
      card.style.cursor = "pointer";

      const row = document.createElement("div");
      row.style.display="flex"; row.style.alignItems="center"; row.style.justifyContent="space-between";
      const name = document.createElement("div");
      name.className = "name";
      name.textContent = `${ex.order ? ex.order+". " : ""}${ex.name}`;
      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = ex.sets || "";
      row.appendChild(name); row.appendChild(badge);
      card.appendChild(row);

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = "Tap to open details";
      card.appendChild(meta);

      const musclesRow = document.createElement("div");
      musclesRow.className = "muscleRow";
      (ex.muscles?.primary||[]).forEach(m=>{ const t=document.createElement("span"); t.className="tagP"; t.textContent=m; musclesRow.appendChild(t); });
      (ex.muscles?.secondary||[]).forEach(m=>{ const t=document.createElement("span"); t.className="tagS"; t.textContent=m; musclesRow.appendChild(t); });
      card.appendChild(musclesRow);

      card.onclick = ()=> navTo(`#/exercise/${encodeURIComponent(group)}/${encodeURIComponent(ex.slug||slugify(ex.name))}`);
      grid.appendChild(card);
    });
    routerView.appendChild(grid);
  }

  function pill(text){
    const span = document.createElement("span");
    span.className = "tag";
    span.textContent = text;
    return span;
  }

  function lsKey(group, slug){ return `muscleImage:${group}:${slug}`; }

  function renderExerciseView(group, slug){
    const list = (PLAN.groups[group]||[]).slice().sort(byOrder);
    const ex = list.find(e => (e.slug||slugify(e.name)) === slug);
    routerView.innerHTML = "";
    routerView.appendChild(renderGroupsBar(group));

    const back = document.createElement("div");
    back.className = "nav";
    const backLink = document.createElement("a");
    backLink.className = "link";
    backLink.href = `#/group/${encodeURIComponent(group)}`;
    backLink.textContent = "← Back to " + group;
    back.appendChild(backLink);
    routerView.appendChild(back);

    if (!ex){
      const empty = document.createElement("div");
      empty.className = "empty";
      empty.textContent = "Exercise not found. Either it was renamed or abducted by bad form.";
      routerView.appendChild(empty);
      return;
    }

    const section = document.createElement("section");
    section.className = "detail";

    const heading = document.createElement("h2");
    heading.textContent = ex.name;
    section.appendChild(heading);

    const meta = document.createElement("div");
    meta.className = "meta";
    const badge = document.createElement("div");
    badge.className = "badge";
    badge.textContent = ex.sets || "";
    meta.appendChild(badge);
    section.appendChild(meta);

    const targets = document.createElement("div");
    targets.className = "muscleRow";
    (ex.muscles?.primary||[]).forEach(m=>{ const t=document.createElement("span"); t.className="tagP"; t.textContent=m; targets.appendChild(t); });
    (ex.muscles?.secondary||[]).forEach(m=>{ const t=document.createElement("span"); t.className="tagS"; t.textContent=m; targets.appendChild(t); });
    section.appendChild(targets);

    // Video + Machine photo
    const mediaWrap = document.createElement("div");
    mediaWrap.className = "two-col";

    const videoBox = document.createElement("div");
    videoBox.className = "card";
    const video = document.createElement("div");
    video.className = "media";
    const iframe = document.createElement("iframe");
    iframe.src = toYouTubeEmbed(ex.youtube||"");
    iframe.title = ex.name + " video";
    iframe.loading = "lazy";
    iframe.allow = "accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
    iframe.referrerPolicy = "strict-origin-when-cross-origin";
    video.appendChild(iframe);
    const vcap = document.createElement("div");
    vcap.className = "dim";
    vcap.style.marginTop = "8px";
    vcap.textContent = "How to do it";
    videoBox.appendChild(video);
    videoBox.appendChild(vcap);

    const photoBox = document.createElement("div");
    photoBox.className = "card";
    const photo = document.createElement("div");
    photo.className = "media";
    const img = document.createElement("img");
    img.src = ex.photo || "";
    img.alt = ex.name + " machine";
    img.loading = "lazy";
    img.style.width = "100%";
    img.style.height = "100%";
    img.style.objectFit = "cover";
    photo.appendChild(img);
    const pcap = document.createElement("div");
    pcap.className = "dim";
    pcap.style.marginTop = "8px";
    pcap.textContent = "Machine to use";
    photoBox.appendChild(photo);
    photoBox.appendChild(pcap);

    mediaWrap.appendChild(videoBox);
    mediaWrap.appendChild(photoBox);
    section.appendChild(mediaWrap);

    // Target muscles card with optional red overlays and local upload
    const musclesBox = document.createElement("div");
    musclesBox.className = "card";

    const topRow = document.createElement("div");
    topRow.style.display = "flex";
    topRow.style.alignItems = "center";
    topRow.style.justifyContent = "space-between";
    const musclesTitle = document.createElement("div");
    musclesTitle.className = "name";
    musclesTitle.textContent = "Target muscles";
    topRow.appendChild(musclesTitle);

    const uploadControls = document.createElement("div");
    uploadControls.className = "uploadRow";
    const fileInput = document.createElement("input");
    fileInput.type = "file"; fileInput.accept = "image/*"; fileInput.id = "file-"+group+"-"+slug;
    const label = document.createElement("label");
    label.className = "fileLabel"; label.setAttribute("for", fileInput.id);
    label.textContent = "Upload muscle image (local)";
    const clearBtn = document.createElement("button");
    clearBtn.className = "btn sm"; clearBtn.textContent = "Clear local";
    uploadControls.appendChild(fileInput);
    uploadControls.appendChild(label);
    uploadControls.appendChild(clearBtn);
    topRow.appendChild(uploadControls);

    musclesBox.appendChild(topRow);

    const muscleMedia = document.createElement("div");
    muscleMedia.className = "media";
    const imgMuscle = document.createElement("img");
    const local = localStorage.getItem(lsKey(group, slug));
    imgMuscle.src = local || ex.muscleImage || "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Anatomy+Image";
    imgMuscle.alt = "Muscle targets";
    imgMuscle.loading = "lazy";
    imgMuscle.style.width = "100%";
    imgMuscle.style.height = "100%";
    imgMuscle.style.objectFit = "cover";
    muscleMedia.appendChild(imgMuscle);

    const overlayHost = document.createElement("div");
    overlayHost.style.position = "absolute";
    overlayHost.style.inset = "0";
    overlayHost.style.pointerEvents = "none";
    muscleMedia.appendChild(overlayHost);

    musclesBox.appendChild(muscleMedia);

    const chipRow = document.createElement("div");
    chipRow.className = "muscleChips";
    musclesBox.appendChild(chipRow);

    const legend = document.createElement("div");
    legend.className = "legend";
    const primaries = (ex.muscles?.primary||[]);
    const secondaries = (ex.muscles?.secondary||[]);
    if (primaries.length){ legend.appendChild(pill("Primary: " + primaries.join(", "))); }
    if (secondaries.length){ legend.appendChild(pill("Secondary: " + secondaries.join(", "))); }
    musclesBox.appendChild(legend);

    const masks = (ex.muscles?.masks||[]).map(m=>({...m}));
    function renderOverlays(){
      overlayHost.innerHTML = "";
      masks.forEach(m=>{
        if (!m.active) return;
        const ov = document.createElement("div");
        ov.className = "maskOverlay";
        ov.style.setProperty("--mask-url", `url(${m.url})`);
        overlayHost.appendChild(ov);
      });
    }
    function renderChips(){
      chipRow.innerHTML = "";
      masks.forEach(m=>{
        const c = document.createElement("span");
        c.className = "mchip"+(m.active?" active":"");
        c.textContent = m.name;
        c.onclick = ()=>{ m.active = !m.active; renderChips(); renderOverlays(); };
        chipRow.appendChild(c);
      });
    }
    renderChips();
    renderOverlays();

    // Local upload handlers (device-only preview)
    fileInput.onchange = (e)=>{
      const file = e.target.files?.[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          localStorage.setItem(lsKey(group, slug), reader.result);
        }catch(err){
          alert("Image too large for local storage. Upload to your repo and set muscleImage to that path.");
        }
        imgMuscle.src = reader.result;
      };
      reader.readAsDataURL(file);
    };
    clearBtn.onclick = ()=>{
      localStorage.removeItem(lsKey(group, slug));
      imgMuscle.src = ex.muscleImage || "https://via.placeholder.com/1280x720/11162a/9fb3c8?text=Anatomy+Image";
    };

    section.appendChild(musclesBox);

    // Attachments
    const atts = ex.attachments || [];
    const attBox = document.createElement("div");
    attBox.className = "card";
    const attHead = document.createElement("div");
    attHead.className = "name";
    attHead.textContent = "Attachments";
    attBox.appendChild(attHead);
    if (!atts.length){
      const none = document.createElement("div");
      none.className = "dim";
      none.textContent = "No special attachment needed.";
      attBox.appendChild(none);
    } else {
      const grid = document.createElement("div");
      grid.className = "attachGrid";
      atts.forEach(a=>{
        const item = document.createElement("div");
        item.className = "attachItem";
        const thumb = document.createElement("div");
        thumb.className = "attachThumb";
        const im = document.createElement("img");
        im.src = a.photo || "https://via.placeholder.com/200x200?text=Attachment";
        im.alt = a.name;
        thumb.appendChild(im);
        const label = document.createElement("div");
        label.textContent = a.name;
        item.appendChild(thumb);
        item.appendChild(label);
        grid.appendChild(item);
      });
      attBox.appendChild(grid);
    }
    section.appendChild(attBox);

    // Notes
    const notes = document.createElement("div");
    notes.className = "notes";
    notes.textContent = ex.notes || "No notes. Breathe, move well, don’t be reckless.";
    section.appendChild(notes);

    routerView.appendChild(section);
  }

  function router(){
    const hash = location.hash || "";
    const parts = hash.split("/").map(x=>decodeURIComponent(x.replace(/^#*/, "")));
    if (parts[1] === "exercise" && parts.length >= 4){
      const group = parts[2];
      const slug = parts[3];
      renderExerciseView(group, slug);
    } else {
      const group = (parts[1] === "group" && parts[2]) ? parts[2] : GROUP_ORDER[0];
      renderGroupView(group);
    }
  }
  window.addEventListener("hashchange", router);
  router();

  // Share + QR helper
  shareBtn.addEventListener("click", async ()=> {
    const url = location.href;
    try{
      await navigator.clipboard.writeText(url);
      shareBtn.textContent = "Link copied";
      setTimeout(()=>shareBtn.textContent="Share",1400);
    }catch(e){
      if (navigator.share) {
        try { await navigator.share({ title: document.title, url }); } catch(_) {}
      } else {
        alert(url);
      }
    }
    qrBox.style.display = "flex";
    urlInput.value = url;
    updateQR();
  });

  function updateQR(){
    const u = encodeURIComponent((urlInput.value||"").trim());
    if (!u){ qrImg.src=""; return; }
    qrImg.src = `https://chart.googleapis.com/chart?cht=qr&chs=256x256&chld=M|0&chl=${u}`;
  }
  urlInput.addEventListener("input", updateQR);
</script>
</body>
</html>
